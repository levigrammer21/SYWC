<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stroud Youth Wrestling Club</title>
  <meta name="description" content="Stroud Youth Wrestling Club â€” announcements, schedule, roster, fundraisers, medal hall, coaches, sponsors." />

  <style>
    :root{
      --blue:#1E3EFF;
      --blue2:#0F1E7A;

      /* tougher palette */
      --text:#0B1020;
      --muted:#6A738A;
      --bg:#0A0F1F;
      --panel:#0E152B;
      --card:#0C1328;
      --card2:#0B1226;
      --line:rgba(255,255,255,.10);

      --shadow: 0 18px 38px rgba(0,0,0,.45);
      --shadow2: 0 10px 18px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;

      --gritA: rgba(255,255,255,.04);
      --gritB: rgba(255,255,255,.02);
      --glow: rgba(30,62,255,.22);
    }

    *{box-sizing:border-box}
    html,body{
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:rgba(255,255,255,.92);
      background: var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .hidden{display:none !important}

    /* gritty mat texture (no images) */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 600px at 18% 10%, rgba(30,62,255,.14), transparent 60%),
        radial-gradient(700px 500px at 82% 18%, rgba(85,166,255,.10), transparent 62%),
        linear-gradient(180deg, rgba(255,255,255,.02), transparent 45%),
        repeating-linear-gradient(135deg, rgba(255,255,255,.018) 0 2px, rgba(0,0,0,.00) 2px 6px);
      opacity:.9;
      mix-blend-mode: normal;
      z-index:0;
    }

    /* ================= HEADER ================= */
    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(10,15,31,.85);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .topbar__inner{
      max-width:1100px;margin:0 auto;
      padding:12px 16px;
      display:flex;align-items:center;gap:14px;justify-content:space-between;
      position:relative;
      z-index:1;
    }
    .topbar__accent{
      height:4px;
      background:linear-gradient(90deg,var(--blue),#55A6FF,var(--blue2));
      clip-path: polygon(0 0, 100% 0, 98% 100%, 0 100%);
    }

    .brand{
      display:flex;align-items:center;gap:12px;
      min-width:0;
    }
    .brand__logo{
      width:44px;height:44px;
      object-fit:contain;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.6));
    }
    .brand__text{display:flex;flex-direction:column;max-width:260px}
    .brand__title{
      font-weight:950;
      letter-spacing:.2px;
      line-height:1.1;
      white-space:normal;
      text-transform: none;
    }
    .brand__tag{
      font-size:12px;
      color:rgba(255,255,255,.65);
      margin-top:2px;
      letter-spacing:.6px;
      text-transform: uppercase;
    }

    .menuBtn{
      display:none;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      color:rgba(255,255,255,.9);
      border-radius:12px;
      padding:10px 12px;
      box-shadow:0 10px 18px rgba(0,0,0,.35);
      animation: pulse 2.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%,100% { box-shadow:0 0 0 0 rgba(30,62,255,.22); }
      50% { box-shadow:0 0 0 9px rgba(30,62,255,0); }
    }

    .nav{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .nav a{
      font-size:13px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color:rgba(255,255,255,.88);
      box-shadow: 0 8px 16px rgba(0,0,0,.22);
      text-transform: uppercase;
      letter-spacing: .6px;
      font-weight: 850;
    }
    .nav a:hover{
      border-color: rgba(85,166,255,.35);
      box-shadow: 0 10px 18px rgba(0,0,0,.30);
    }
    .nav a.active{
      background: linear-gradient(180deg, rgba(30,62,255,.30), rgba(15,30,122,.10));
      border-color: rgba(85,166,255,.55);
      box-shadow: 0 0 0 4px rgba(30,62,255,.12), 0 14px 24px rgba(0,0,0,.35);
    }

    /* ================= LAYOUT ================= */
    .main{
      max-width:1100px;
      margin:0 auto;
      padding:18px 16px 40px;
      position:relative;
      z-index:1;
    }

    .page{
      display:block;
      scroll-margin-top:110px;
      padding-top:12px;
      margin-top:12px;
    }

    .pageHead{margin:10px 0 14px}
    .pageHead h2{
      margin:0;
      font-size:26px;
      letter-spacing:.2px;
      text-transform: uppercase;
      font-weight: 1000;
    }
    .pageHead p{margin:6px 0 0}
    .muted{color:rgba(255,255,255,.62)}

    /* ================= FILTERS ================= */
    .filters{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .input{
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.92);
      outline:none;
    }
    .input::placeholder{color: rgba(255,255,255,.55)}
    .input:focus{
      border-color: rgba(85,166,255,.55);
      box-shadow:0 0 0 4px rgba(30,62,255,.18);
    }

    /* ================= BUTTONS ================= */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      border-radius:14px;
      padding:10px 14px;
      font-weight:1000;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.92);
      text-decoration:none;
      box-shadow: 0 10px 18px rgba(0,0,0,.30);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      text-transform: uppercase;
      letter-spacing:.6px;
      font-size: 13px;
    }
    .btn:hover{box-shadow:0 14px 24px rgba(0,0,0,.38)}
    .btn:active{transform:translateY(1px)}
    .btn--primary{
      color:#fff;
      border:1px solid rgba(85,166,255,.35);
      background:linear-gradient(180deg, rgba(30,62,255,.95), rgba(15,30,122,.95));
      box-shadow: 0 0 0 4px rgba(30,62,255,.12), 0 16px 30px rgba(0,0,0,.38);
    }
    .btn--big{width:100%; padding:14px 14px;}

    /* ================= GRID / CARDS ================= */
    .grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:14px;
    }
    .grid--cards{grid-template-columns: repeat(3, minmax(0, 1fr));}
    .grid--sponsors{grid-template-columns: repeat(4, minmax(0, 1fr));}

    .card{
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow2);
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow: var(--shadow);
      border-color: rgba(85,166,255,.28);
    }

    .card__img{
      width:100%;
      aspect-ratio: 1 / 1;
      object-fit:cover;
      background: rgba(255,255,255,.03);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .card__body{padding:12px 12px 14px}
    .card__title{font-weight:1000; letter-spacing:.2px}
    .card__sub{margin-top:4px;font-size:13px;color:rgba(255,255,255,.70)}

    .chips{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.85);
      text-transform: uppercase;
      letter-spacing:.5px;
      font-weight: 900;
    }
    .chip--blue{
      border-color: rgba(85,166,255,.35);
      box-shadow:0 10px 18px rgba(0,0,0,.22);
    }

    /* ================= SCHEDULE LIST ================= */
    .list{display:flex; flex-direction:column; gap:10px;}
    .row{
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      padding:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow2);
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
    }
    .row__left{display:flex;gap:12px;align-items:flex-start}
    .row__content{min-width:0}
    .dateBox{
      min-width:86px;
      border:1px solid rgba(85,166,255,.30);
      border-radius:16px;
      padding:10px;
      background: linear-gradient(180deg, rgba(30,62,255,.20), rgba(15,30,122,.08));
      text-align:center;
      box-shadow: 0 10px 18px rgba(0,0,0,.25);
    }
    .dateText{
  font-size:12px;
  font-weight:1000;
  text-transform:uppercase;
  letter-spacing:.6px;
  line-height:1.15;
  padding:10px 2px;
  color:rgba(255,
    .dateBox .m{font-size:12px;color:rgba(255,255,255,.70);font-weight:950;text-transform:uppercase}
    .dateBox .d{font-size:22px;font-weight:1000;line-height:1;margin-top:2px}
    .dateBox .y{font-size:12px;color:rgba(255,255,255,.70);margin-top:2px}

    .row__title{font-weight:1000}
    .row__title--big{font-size:18px;font-weight:1000}
    .row__meta{margin-top:4px;color:rgba(255,255,255,.70);font-size:13px}
    .row__note{margin-top:8px;color:rgba(255,255,255,.90);font-size:13px}
    .row__right{display:flex; flex-direction:column; gap:8px; align-items:flex-end;}
    .past{opacity:.55}

    /* ================= ANNOUNCEMENTS ================= */
    .stack{display:flex; flex-direction:column; gap:12px;}
    .announce{
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      padding:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow2);
    }
    .announce--pinned{
      border-color: rgba(85,166,255,.45);
      box-shadow: 0 0 0 4px rgba(30,62,255,.12), var(--shadow);
      position:relative;
    }
    .announce--pinned::before{
      content:"PINNED";
      position:absolute;
      top:12px; right:12px;
      font-size:11px;
      font-weight:1000;
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      background:linear-gradient(180deg, rgba(30,62,255,.95), rgba(15,30,122,.95));
      border:1px solid rgba(85,166,255,.35);
      letter-spacing:.8px;
    }

    .announceRow{display:flex; gap:14px; align-items:flex-start; justify-content:space-between;}
    .announceMain{flex:1; min-width:0;}
    .announceCTA{min-width:180px; display:flex; justify-content:flex-end;}
    .announce__title{font-weight:1000; text-transform: uppercase; letter-spacing:.6px;}
    .announce__date{font-size:12px;color:rgba(255,255,255,.68);margin-top:4px}
    .announce__date--big{font-size:14px;font-weight:950;color:rgba(255,255,255,.92);margin-top:6px}
    .announce__msg{margin-top:10px; white-space:pre-wrap; color: rgba(255,255,255,.88);}

    /* ================= SPONSORS ================= */
    .sponsor{
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      padding:12px;
      box-shadow: var(--shadow2);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .sponsor__logo{
      width:100%;
      aspect-ratio: 16 / 9;
      object-fit:contain;
      background: rgba(255,255,255,.03);
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      padding:10px;
    }
    .sponsor__name{font-weight:1000; text-transform: uppercase; letter-spacing:.6px;}
    .sponsor__meta{font-size:12px;color:rgba(255,255,255,.70)}
    .sponsor__note{font-size:12px;color:rgba(255,255,255,.70);white-space:pre-wrap}

    /* ================= EMPTY STATE ================= */
    .empty{
      margin-top:14px;
      padding:16px;
      border:1px dashed rgba(85,166,255,.40);
      border-radius:var(--radius);
      background: rgba(255,255,255,.03);
      color:rgba(255,255,255,.70);
    }

    /* ================= FOOTER ================= */
    .footer{
      border-top:1px solid rgba(255,255,255,.08);
      padding:18px 16px;
      background: rgba(10,15,31,.70);
      position:relative;
      z-index:1;
    }
    .footer__inner{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      gap:10px;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .footer__small{font-size:12px; letter-spacing:.8px; text-transform: uppercase;}

    /* ================= RESPONSIVE ================= */
    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(3, minmax(0, 1fr));}
      .grid--cards{grid-template-columns: repeat(2, minmax(0, 1fr));}
      .grid--sponsors{grid-template-columns: repeat(3, minmax(0, 1fr));}
    }

    /* Phones only */
    @media (max-width: 520px){
      .menuBtn{display:inline-flex}

      .nav{
        position:fixed;
        top:68px; right:16px; left:16px;
        background: rgba(10,15,31,.98);
        border:1px solid rgba(255,255,255,.12);
        border-radius:18px;
        padding:12px;
        box-shadow: var(--shadow);
        display:none;
        flex-direction:column;
        align-items:stretch;
        z-index:60;
      }
      .nav.open{display:flex}
      .nav a{border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04)}

      .grid{grid-template-columns: repeat(2, minmax(0, 1fr));}
      .grid--sponsors{grid-template-columns: repeat(2, minmax(0, 1fr));}

      .row{flex-direction:column;align-items:stretch}
      .row__right{align-items:flex-start}

      .announceRow{flex-direction:column;}
      .announceCTA{width:100%; min-width:0;}
    }

    /* Fold open / tablets / desktop */
    @media (min-width: 521px){
      .menuBtn{display:none !important}
      .nav{display:flex !important}
    }

    /* ================= MEDAL HALL: horizontal strip ================= */
    #medalGrid.hscroll{
      display:flex;
      flex-direction:row;
      flex-wrap:nowrap;
      gap:14px;

      overflow-x:auto;
      overflow-y:hidden;
      padding-bottom:10px;

      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling: touch;

      /* hide scrollbar on many browsers while keeping it usable */
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.18) transparent;
    }

    #medalGrid.hscroll .card{
      flex:0 0 320px;
      width:320px;
      max-width:320px;
      scroll-snap-align:start;
    }

    /* Medal hall images: less cut off without being bigger */
    #medalGrid.hscroll .card__img{
      height:180px;
      max-height:180px;
      aspect-ratio:auto;
      object-fit:contain;          /* key change */
      object-position:center;      /* keep centered */
      background: rgba(255,255,255,.03);
      padding:6px;                /* slight inset so edges show */
    }

    @media (max-width: 520px){
      #medalGrid.hscroll .card{
        flex-basis:260px;
        width:260px;
        max-width:260px;
      }
      #medalGrid.hscroll .card__img{
        height:160px;
        max-height:160px;
      }
    }

    /* ================= ROSTER: 2-rows tall horizontal scroll ================= */
    /* We keep your #rosterGrid id, but turn it into a 2-row horizontal scroller */
    #rosterGrid{
      display:grid;
      grid-auto-flow: column;                  /* fill columns left->right */
      grid-template-rows: repeat(2, 1fr);      /* exactly 2 rows */
      grid-auto-columns: minmax(220px, 260px); /* card width */
      gap:14px;

      overflow-x:auto;
      overflow-y:hidden;
      padding-bottom:10px;

      scroll-snap-type:x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    #rosterGrid .card{
      scroll-snap-align:start;
    }

    @media (max-width: 520px){
      #rosterGrid{
        grid-auto-columns: minmax(190px, 230px);
      }
    }

    /* ================= COACHES: fixed card size + inner scroll for bio ================= */
    /* Make coach cards consistent, and let bio scroll inside */
    #coachesGrid .card{
      height: 420px;           /* fixed size */
      display:flex;
      flex-direction:column;
    }
    #coachesGrid .card__img{
      flex: 0 0 auto;
    }
    #coachesGrid .card__body{
      flex: 1 1 auto;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:0;            /* allows inner scroll */
    }
    .coachBio{
      flex: 1 1 auto;
      min-height:0;
      overflow:auto;
      padding-right: 6px;
      color: rgba(255,255,255,.80);
      line-height: 1.35;
      border-top: 1px solid rgba(255,255,255,.08);
      padding-top: 10px;
    }
    .coachBio::-webkit-scrollbar{width:10px}
    .coachBio::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.16);
      border-radius: 999px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }
    .coachBio::-webkit-scrollbar-track{background: transparent}
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar__inner">
      <a class="brand" href="#announcements" aria-label="Go to announcements">
        <img class="brand__logo" src="images/logo.png" alt="Stroud Youth Wrestling Club Tiger Logo" />
        <div class="brand__text">
          <div class="brand__title">Stroud Youth Wrestling Club</div>
          <div class="brand__tag">#Workdontwish!</div>
        </div>
      </a>

      <button id="menuBtn" class="menuBtn" aria-label="Open menu" aria-expanded="false">â˜°</button>

      <nav class="nav" id="nav">
        <a href="#announcements">Announcements</a>
        <a href="#schedule">Schedule</a>
        <a href="#roster">Roster</a>
        <a href="#fundraisers">Fundraisers</a>
        <a href="#medal-hall">Medal Hall</a>
        <a href="#coaches">Coaches</a>
        <a href="#sponsors">Sponsors</a>
      </nav>
    </div>
    <div class="topbar__accent"></div>
  </header>

  <main class="main">
    <section class="page" id="announcements" data-page="announcements">
      <div class="pageHead">
        <h2>Announcements</h2>
        <p class="muted">Latest updates from the club.</p>
      </div>
      <div id="announcementsWrap" class="stack"></div>
      <div id="announcementsEmpty" class="empty hidden">No announcements yet.</div>
    </section>

    <section class="page" id="schedule" data-page="schedule">
      <div class="pageHead">
        <h2>Schedule</h2>
        <p class="muted">Tournaments, duals, practices â€” all in one place.</p>
      </div>
      <div id="scheduleList" class="list"></div>
      <div id="scheduleEmpty" class="empty hidden">No events yet.</div>
    </section>

    <section class="page" id="roster" data-page="roster">
      <div class="pageHead">
        <h2>Roster</h2>
        <p class="muted">Swipe left/right â€” Tap a wrestler to open their Flo profile.</p>
        <div class="filters">
          <input id="rosterSearch" class="input" placeholder="Search name or nicknameâ€¦" />
          <select id="divisionFilter" class="input"></select>
          <select id="weightFilter" class="input"></select>
        </div>
      </div>
      <!-- IMPORTANT: keep id="rosterGrid" but it is now the scroller -->
      <div id="rosterGrid"></div>
      <div id="rosterEmpty" class="empty hidden">No wrestlers match your filters.</div>
    </section>

    <section class="page" id="fundraisers" data-page="fundraisers">
      <div class="pageHead">
        <h2>Fundraisers</h2>
        <p class="muted">Help support the club.</p>
      </div>
      <div id="fundraisersGrid" class="grid grid--cards"></div>
      <div id="fundraisersEmpty" class="empty hidden">No fundraisers listed.</div>
    </section>

    <section class="page" id="medal-hall" data-page="medal-hall">
      <div class="pageHead">
        <h2>Medal Hall</h2>
        <p class="muted">Swipe through recent medalists. See the ones who got it done ðŸ’ª</p>
      </div>
      <div id="medalGrid" class="hscroll"></div>
      <div id="medalEmpty" class="empty hidden">No medal hall entries yet.</div>
    </section>

    <section class="page" id="coaches" data-page="coaches">
      <div class="pageHead">
        <h2>Meet the Coaches</h2>
        <p class="muted">Tap/scroll inside a coach card to read the full bio.</p>
      </div>
      <div id="coachesGrid" class="grid grid--cards"></div>
      <div id="coachesEmpty" class="empty hidden">No coaches listed.</div>
    </section>

    <section class="page" id="sponsors" data-page="sponsors">
      <div class="pageHead">
        <h2>Sponsors</h2>
        <p class="muted">Thank you to the businesses supporting SYWC!</p>
      </div>
      <div id="sponsorsGrid" class="grid grid--sponsors"></div>
      <div id="sponsorsEmpty" class="empty hidden">No sponsors listed yet.</div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer__inner">
      <div>Â© <span id="year"></span> Stroud Youth Wrestling Club</div>
      <div class="footer__small muted">#LETSGO</div>
    </div>
  </footer>

  <script>
    // ================== SYWC Sheet-Driven Site (STABLE + requested UX changes) ==================

    const SHEET_ID = "1dPPX4OQeafjlVBu1pRi-n98hTCbM0BsQRFQJbEcCEUw";

    const TABS = {
      announcements: "ANNOUNCEMENTS",
      schedule: "SCHEDULE",
      roster: "ROSTER",
      fundraisers: "FUNDRAISERS",
      medalHall: "MEDAL_HALL",
      coaches: "COACHES",
      sponsors: "SPONSORS",
    };

    // ---------- DOM helpers ----------
    const qs = (s, r = document) => r.querySelector(s);

    // ---------- value helpers ----------
    const raw = (v) => String(v ?? "");

    function cleanCell(v) {
      return raw(v)
        .replaceAll("\u00A0", " ")
        .trim()
        .replace(/^"+|"+$/g, "")
        .trim();
    }

    function isBlank(v) {
      const s = cleanCell(v).toLowerCase();
      return !s || s === "na" || s === "n/a" || s === "none" || s === '""' || s === '"';
    }

    const toBool = (v) => ["true", "yes", "1", "y"].includes(cleanCell(v).toLowerCase());

    const escapeHtml = (str) =>
      raw(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");

    const escapeAttr = (str) => escapeHtml(str).replaceAll("`", "&#096;");

    // ---------- sheet fetching ----------
    function csvUrl(tab) {
      return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(tab)}`;
    }

    function parseCSV(text) {
      const rows = [];
      let cur = "", inQuotes = false, row = [];

      for (let i = 0; i < text.length; i++) {
        const c = text[i], n = text[i + 1];

        if (c === '"' && n === '"') { cur += '"'; i++; continue; }
        if (c === '"') { inQuotes = !inQuotes; continue; }

        if (!inQuotes && c === ",") { row.push(cur); cur = ""; continue; }

        if (!inQuotes && (c === "\n" || c === "\r")) {
          if (c === "\r" && n === "\n") i++;
          row.push(cur);
          rows.push(row);
          row = [];
          cur = "";
          continue;
        }

        cur += c;
      }

      if (cur || row.length) { row.push(cur); rows.push(row); }
      if (!rows.length) return [];

      const headers = rows.shift().map((h) => cleanCell(h));

      return rows.map((r) => {
        const o = {};
        headers.forEach((h, i) => (o[h] = cleanCell(r[i])));
        return o;
      });
    }

    async function loadTab(tab) {
      const res = await fetch(csvUrl(tab), { cache: "no-store" });
      if (!res.ok) throw new Error(`Failed to load ${tab}: ${res.status}`);
      const rows = parseCSV(await res.text());
      return rows.filter((r) => toBool(r.visible ?? true));
    }

    // ---------- date helper ----------
    function fmtDate(v) {
      if (isBlank(v)) return null;
      const s = cleanCell(v);
      let d;

      if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)) {
        const [m, day, y] = s.split("/").map(Number);
        d = new Date(y, m - 1, day, 12);
      } else if (/^\d{4}-\d{2}-\d{2}$/.test(s)) {
        d = new Date(s + "T12:00:00");
      } else {
        d = new Date(s);
      }

      if (Number.isNaN(d.getTime())) return null;

      return {
        m: d.toLocaleString("en-US", { month: "short" }),
        d: d.getDate(),
        y: d.getFullYear(),
        date: d,
      };
    }

    // ---------- image path helper ----------
    function normalizeImageUrl(url) {
      const u = cleanCell(url);
      if (isBlank(u)) return "";
      if (/^(https?:\/\/|data:)/i.test(u)) return u;
      if (u.startsWith("images/")) return `./${u}`;
      if (u.startsWith("/")) return u;
      return u;
    }

    /* ================= ANNOUNCEMENTS ================= */
    function renderAnnouncements(rows) {
      const wrap = qs("#announcementsWrap");
      const empty = qs("#announcementsEmpty");
      if (!wrap) return;

      wrap.innerHTML = "";

      const sorted = rows.slice().sort((a, b) => {
        const ap = toBool(a.pin_to_top);
        const bp = toBool(b.pin_to_top);
        if (ap !== bp) return ap ? -1 : 1;
        const da = fmtDate(a.date)?.date?.getTime() ?? 0;
        const db = fmtDate(b.date)?.date?.getTime() ?? 0;
        return db - da;
      });

      wrap.innerHTML = sorted
        .map((r) => {
          const d = fmtDate(r.date);
          const title = cleanCell(r.title);
          const msg = cleanCell(r.message);
          const ctaLabel = cleanCell(r.cta_label);
          const ctaUrl = cleanCell(r.cta_url);

          return `
            <div class="announce ${toBool(r.pin_to_top) ? "announce--pinned" : ""}">
              <div class="announceRow">
                <div>
                  <div class="announce__title">${escapeHtml(title)}</div>
                  ${
                    d
                      ? `<div class="announce__date announce__date--big">${escapeHtml(`${d.m} ${d.d}, ${d.y}`)}</div>`
                      : ""
                  }
                  ${!isBlank(msg) ? `<div class="announce__msg">${escapeHtml(msg)}</div>` : ""}
                </div>
                ${
                  !isBlank(ctaLabel) && !isBlank(ctaUrl)
                    ? `<a class="btn btn--primary btn--big" href="${escapeAttr(ctaUrl)}" target="_blank" rel="noopener">${escapeHtml(ctaLabel)}</a>`
                    : ""
                }
              </div>
            </div>`;
        })
        .join("");

      if (empty) empty.classList.toggle("hidden", sorted.length > 0);
    }

    /* ================= SCHEDULE ================= */
    function renderSchedule(rows) {
      const list = qs("#scheduleList");
      const empty = qs("#scheduleEmpty");
      if (!list) return;

      list.innerHTML = "";

      const sorted = rows.slice().sort((a, b) => {
        const da = fmtDate(a.date)?.date?.getTime() ?? 0;
        const db = fmtDate(b.date)?.date?.getTime() ?? 0;
        return da - db;
      });

      list.innerHTML = sorted
        .map((r) => {
          const d = fmtDate(r.date);
          const type = cleanCell(r.type);
          const name = cleanCell(r.name);
          const title = !isBlank(type) ? type : name;

          const meta = [];
          if (!isBlank(r.location)) meta.push(cleanCell(r.location));
          if (!isBlank(r.start_time)) meta.push(`Start: ${cleanCell(r.start_time)}`);
          if (!isBlank(r.weigh_in_time)) meta.push(`Weigh-in: ${cleanCell(r.weigh_in_time)}`);

          const notes = cleanCell(r.notes);
          const link = cleanCell(r.link_url);
          const btnLabel = cleanCell(r.details_label);

          return `
            <div class="dateBox">
  ${
    d
      ? `
        <div class="m">${escapeHtml(d.m)}</div>
        <div class="d">${escapeHtml(d.d)}</div>
        <div class="y">${escapeHtml(d.y)}</div>
      `
      : `
      <div class="dateText">
  ${escapeHtml(cleanCell(r.date))}
</div>  
      `
  }
</div>
                <div class="row__content">
                  <div class="row__title row__title--big">${escapeHtml(title)}</div>
                  ${meta.length ? `<div class="row__meta">${escapeHtml(meta.join(" â€¢ "))}</div>` : ""}
                  ${!isBlank(notes) ? `<div class="row__note">${escapeHtml(notes)}</div>` : ""}
                </div>
              </div>
              ${
                !isBlank(link) && !isBlank(btnLabel)
                  ? `<a class="btn btn--primary" href="${escapeAttr(link)}" target="_blank" rel="noopener">${escapeHtml(btnLabel)}</a>`
                  : ""
              }
            </div>`;
        })
        .join("");

      if (empty) empty.classList.toggle("hidden", sorted.length > 0);
    }

    /* ================= ROSTER ================= */
    function renderRoster(rows) {
      const grid = qs("#rosterGrid");
      const empty = qs("#rosterEmpty");
      if (!grid) return;

      grid.innerHTML = "";

      grid.innerHTML = rows
        .map((r) => {
          const name = cleanCell(r.name);
          const nick = cleanCell(r.nickname);
          const div = cleanCell(r.division);
          const wt = cleanCell(r.weight_class);
          const img = normalizeImageUrl(r.photo_url);
          const flo = cleanCell(r.flo_url);

          const stats = [];
          if (!isBlank(r.wins) || !isBlank(r.losses)) stats.push(`W-L ${cleanCell(r.wins || 0)}-${cleanCell(r.losses || 0)}`);
          if (!isBlank(r.pins)) stats.push(`Pins ${cleanCell(r.pins)}`);
          if (!isBlank(r.points)) stats.push(`Pts ${cleanCell(r.points)}`);

          const href = !isBlank(flo) ? `href="${escapeAttr(flo)}" target="_blank" rel="noopener"` : "";

          // Card unchanged; the container (#rosterGrid) is now a 2-row horizontal scroller via CSS.
          return `
            <a class="card" ${href}>
              <img class="card__img" src="${escapeAttr(img)}" alt="${escapeAttr(name)}" loading="lazy" />
              <div class="card__body">
                <div class="card__title">${escapeHtml(name)}</div>
                ${!isBlank(nick) ? `<div class="card__sub">"${escapeHtml(nick)}"</div>` : ""}
                <div class="chips">
                  ${!isBlank(div) ? `<span class="chip chip--blue">${escapeHtml(div)}</span>` : ""}
                  ${!isBlank(wt) ? `<span class="chip">${escapeHtml(wt)}</span>` : ""}
                  ${stats.map((s) => `<span class="chip">${escapeHtml(s)}</span>`).join("")}
                </div>
              </div>
            </a>`;
        })
        .join("");

      if (empty) empty.classList.toggle("hidden", rows.length > 0);
    }

    /* ================= FUNDRAISERS ================= */
    function renderFundraisers(rows) {
      const grid = qs("#fundraisersGrid");
      const empty = qs("#fundraisersEmpty");
      if (!grid) return;

      grid.innerHTML = rows
        .map((r) => {
          const title = cleanCell(r.title);
          const desc = cleanCell(r.description);
          const img = normalizeImageUrl(r.image_url);
          const ctaLabel = cleanCell(r.cta_label);
          const ctaUrl = cleanCell(r.cta_url);

          return `
            <div class="card">
              ${!isBlank(img) ? `<img class="card__img" src="${escapeAttr(img)}" alt="${escapeAttr(title)}" loading="lazy" style="aspect-ratio:16/9">` : ""}
              <div class="card__body">
                <div class="card__title">${escapeHtml(title)}</div>
                ${!isBlank(desc) ? `<div class="card__sub" style="margin-top:10px; white-space:pre-wrap">${escapeHtml(desc)}</div>` : ""}
                ${
                  !isBlank(ctaLabel) && !isBlank(ctaUrl)
                    ? `<div style="margin-top:12px"><a class="btn btn--primary" href="${escapeAttr(ctaUrl)}" target="_blank" rel="noopener">${escapeHtml(ctaLabel)}</a></div>`
                    : ""
                }
              </div>
            </div>`;
        })
        .join("");

      if (empty) empty.classList.toggle("hidden", rows.length > 0);
    }

    /* ================= MEDAL HALL ================= */
    let medalAutoTimer = null;

    function stopMedalAutoScroll() {
      if (medalAutoTimer) {
        clearInterval(medalAutoTimer);
        medalAutoTimer = null;
      }
    }

    function startMedalAutoScroll() {
      const grid = qs("#medalGrid");
      if (!grid) return;

      stopMedalAutoScroll();

      medalAutoTimer = setInterval(() => {
        const firstCard = grid.querySelector(".card");
        if (!firstCard) return;

        // advance by one card width + gap
        const gap = 14;
        const step = firstCard.getBoundingClientRect().width + gap;

        const maxScroll = grid.scrollWidth - grid.clientWidth;
        const next = grid.scrollLeft + step;

        // loop back to start when at end
        grid.scrollTo({
          left: next >= maxScroll - 5 ? 0 : next,
          behavior: "smooth",
        });
      }, 4200);
    }

    function renderMedalHall(rows) {
      const grid = qs("#medalGrid");
      const empty = qs("#medalEmpty");
      if (!grid) return;

      const sorted = rows.slice().sort((a, b) => {
        const da = fmtDate(a.date)?.date?.getTime() ?? 0;
        const db = fmtDate(b.date)?.date?.getTime() ?? 0;
        return db - da;
      });

      grid.innerHTML = sorted
        .map((r) => {
          const img = normalizeImageUrl(r.photo_url);
          const title = cleanCell(r.wrestler_name);
          const tourney = cleanCell(r.tournament_name);
          const notes = cleanCell(r.notes);

          return `
            <div class="card">
              ${!isBlank(img) ? `<img class="card__img" src="${escapeAttr(img)}" alt="${escapeAttr(title || tourney || "Medal")}" loading="lazy" style="aspect-ratio:16/9">` : ""}
              <div class="card__body">
                ${!isBlank(title) ? `<div class="card__title">${escapeHtml(title)}</div>` : ""}
                ${!isBlank(tourney) ? `<div class="card__sub">${escapeHtml(tourney)}</div>` : ""}
                ${!isBlank(notes) ? `<div class="card__sub" style="margin-top:8px; white-space:pre-wrap">${escapeHtml(notes)}</div>` : ""}
              </div>
            </div>`;
        })
        .join("");

      if (empty) empty.classList.toggle("hidden", sorted.length > 0);

      // Auto-scroll behavior (pause on interaction)
      stopMedalAutoScroll();
      if (sorted.length > 1) {
        startMedalAutoScroll();

        const pause = () => stopMedalAutoScroll();
        const resume = () => startMedalAutoScroll();

        // manual swipe should pause, then resume after a moment
        let resumeTimeout = null;
        const scheduleResume = () => {
          if (resumeTimeout) clearTimeout(resumeTimeout);
          resumeTimeout = setTimeout(() => resume(), 6000);
        };

        grid.onpointerdown = () => { pause(); };
        grid.onpointerup = () => { scheduleResume(); };
        grid.ontouchstart = () => { pause(); };
        grid.ontouchend = () => { scheduleResume(); };
        grid.onmouseenter = () => { pause(); };
        grid.onmouseleave = () => { scheduleResume(); };
        grid.onscroll = () => { scheduleResume(); };
      }
    }

    /* ================= COACHES ================= */
    function renderCoaches(rows) {
      const grid = qs("#coachesGrid");
      const empty = qs("#coachesEmpty");
      if (!grid) return;

      grid.innerHTML = rows
        .map((r) => {
          const name = cleanCell(r.name);
          const role = cleanCell(r.role);
          const img = normalizeImageUrl(r.photo_url);
          const bio = cleanCell(r.bio);

          // NOTE: bio now lives in a scrollable div (.coachBio)
          return `
            <div class="card">
              ${!isBlank(img) ? `<img class="card__img" src="${escapeAttr(img)}" alt="${escapeAttr(name)}" loading="lazy" style="aspect-ratio:1/1">` : ""}
              <div class="card__body">
                <div class="card__title">${escapeHtml(name)}</div>
                ${!isBlank(role) ? `<div class="card__sub">${escapeHtml(role)}</div>` : ""}
                ${!isBlank(bio) ? `<div class="coachBio">${escapeHtml(bio)}</div>` : `<div class="coachBio muted">Bio coming soon.</div>`}
              </div>
            </div>`;
        })
        .join("");

      if (empty) empty.classList.toggle("hidden", rows.length > 0);
    }

    /* ================= SPONSORS ================= */
    function renderSponsors(rows) {
      const grid = qs("#sponsorsGrid");
      const empty = qs("#sponsorsEmpty");
      if (!grid) return;

      grid.innerHTML = rows
        .map((r) => {
          const name = cleanCell(r.name);
          const level = cleanCell(r.level);
          const logo = normalizeImageUrl(r.logo_url);
          const url = cleanCell(r.website_url);

          return `
            <div class="sponsor">
              ${!isBlank(logo) ? `<img class="sponsor__logo" src="${escapeAttr(logo)}" alt="${escapeAttr(name)}" loading="lazy">` : ""}
              <div class="sponsor__name">${escapeHtml(name)}</div>
              <div class="sponsor__meta">${escapeHtml(!isBlank(level) ? level : "Sponsor")}</div>
              ${!isBlank(url) ? `<a class="btn btn--primary" href="${escapeAttr(url)}" target="_blank" rel="noopener">Visit</a>` : ""}
            </div>`;
        })
        .join("");

      if (empty) empty.classList.toggle("hidden", rows.length > 0);
    }

    /* ================= MOBILE MENU ================= */
    function initMenu() {
      const btn = qs("#menuBtn");
      const nav = qs("#nav");
      if (!btn || !nav) return;

      btn.addEventListener("click", () => {
        const open = nav.classList.toggle("open");
        btn.setAttribute("aria-expanded", open ? "true" : "false");
      });

      // close menu when a link is clicked (mobile)
      nav.addEventListener("click", (e) => {
        const a = e.target.closest("a");
        if (!a) return;
        if (nav.classList.contains("open")) {
          nav.classList.remove("open");
          btn.setAttribute("aria-expanded", "false");
        }
      });
    }

    /* ================= INIT ================= */
    async function init() {
      initMenu();

      const yearEl = qs("#year");
      if (yearEl) yearEl.textContent = String(new Date().getFullYear());

      try {
        const [announcements, schedule, roster, fundraisers, medal, coaches, sponsors] = await Promise.all([
          loadTab(TABS.announcements),
          loadTab(TABS.schedule),
          loadTab(TABS.roster),
          loadTab(TABS.fundraisers),
          loadTab(TABS.medalHall),
          loadTab(TABS.coaches),
          loadTab(TABS.sponsors),
        ]);

        renderAnnouncements(announcements);
        renderSchedule(schedule);
        renderRoster(roster);
        renderFundraisers(fundraisers);
        renderMedalHall(medal);
        renderCoaches(coaches);
        renderSponsors(sponsors);
      } catch (err) {
        console.error(err);
        alert(
          "Could not load the team sheet data.\n\n" +
            "Fix checklist:\n" +
            "1) Google Sheet is shared as 'Anyone with the link can view'\n" +
            "2) Tab names match exactly (ANNOUNCEMENTS, SCHEDULE, ...)\n" +
            "3) Row 1 headers match exactly\n\n" +
            "Then refresh."
        );
      }
    }

    init();
  </script>
</body>
</html>
